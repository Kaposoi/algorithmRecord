# 事务

## 事务的基本介绍

### 概念

如果一个包含多个步骤的业务操作被事务管理，那么这些操作要么同时成功，要么同时失败。

### 操作

>#### 开启事务
>
>start transaction;
>
>回滚事务
>
>rollback;
>
>提交事务
>
>commit;

### 注意事项

>一个DML（增删改）语句会自动提交一次事务



## 手动提交和自动提交

>mysql是自动提交的
>
>手动提交需要start transaction开启事务。
>
>再用commit提交事务。
>
>查看提交方式
>
>select @@autocommit  结果是1表示自动，0表示手动。
>
>set @@autocommit = 0; 可以修改默认提交方式。
>
>Oracle默认手动提交。



## 事务的四大特征

### 原子性

>是不可分割的最小操作单位，要么同时成功，要么同时失败

### 持久性

>当事务提交或回滚后，数据库会持久化的保存数据

### 隔离性

>多个事务之间相互独立

### 一致性

>事务操作前后，数据总量不变



## 事务的隔离级别

### 概念

>多个事务之间隔离的，相互独立的，但是如果多个事务操作同一批数据，则会引发一些问题，设置不同的隔离级别就可以解决这些问题

### 存在问题

#### 脏读

一个事务读取到另一个事务中没有提交的数据

#### 不可重复读(虚读)

在同一个事物中，两个读取到的数据不一样

#### 幻读

一个事物操作(DML)数据表中的所有记录，另一个事物添加了一条数据，则第一个事物查询不到自己的修改

### 隔离级别

#### read uncommited 读未提交

产生的问题: 以上三个

#### read commited 读已提交 (oracle 默认)

产生的问题: 不可重复读，幻读

#### repeatable read 可重复读 (mysql 默认)

产生的问题: 幻读

#### serializable 串行化

可以解决所有的问题



隔离级别从小到大安全性越来越高，但是效率越来越低



### 设置隔离级别

select @@tx_isolation 查询

set global transaction isolation level 级别字符串