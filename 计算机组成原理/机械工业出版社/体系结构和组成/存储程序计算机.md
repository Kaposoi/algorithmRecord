# 存储程序计算机

ARM这一类处理器采取了存储程序体系结构， 它将数据和程序放在同一个存储空间内， 采用*取指-执行*模式来执行， 按照顺序从内存*读取指令， 解码， 执行*



寄存器是位于CPU内部的存储单元， 类似于内存中的存储单元， *寄存器使用名字而不是地址来访问*(也就是说， 指令中寄存器用名字来访问， 其他数据用地址来访问)

如:

>r0, r1, ..., r15(ARM命名)
>
>AX, BX, CX, DX, SP, BP, SI(Inter命名)
>
>D0， ... D7(Freesacle命名)



计算机指令的操作码可以使用很少的几位来引用寄存器， 指令中用来选择寄存器的字段一般为3~5位(2^3 = 8 ~ 2 ^ 5 = 32)， 具体数值取决于计算机中程序*可见寄存器*的个数

>有些寄存器程序员无法用， 比如IR和CCR



CPU中的寄存器有几个功能， 有一些是*高速暂存寄存器(通用寄存器)*, 用于保存数据或者是数据单元的地址， 另外一些是*特殊功能*寄存器， 如对循环技术的循环寄存器， 有的用来记录处理器的状态， 最重要的是**PC程序计数器**，它记录了下一条指令的***地址***



计算机指令有多种格式， 一般提供三种

LDR 目的寄存器， 存储单元源(地址)

STR 寄存器源(地址), 目的存储单元

Operation 目的寄存器， 寄存器1， 寄存器2



## 虚拟结构

![结构](F:\E盘\编程学习\计算机组成原理\机械工业出版社\计算机体系结构\结构.png)

>MAR(Memory Address Register) 存储器地址寄存器， 保存了读或写操作*正在访问*的存储单元的地址
>
>MBR(Memory Buffer Register) 存储器数据寄存器， 保存了刚从存储器中读出的数据， 或是即将写入存储器中的数据
>
>PC 程序计数器， 保存了下一条指令的地址
>
>IR 指令寄存器， 存放了*当前正在执行的*指令
>
> 
>
>ALU 算逻运算单元， 可以通过单操作数运算或者是双操作数运算对数据进行处理
>
>一元运算: 取负， 递增， 清除(0)
>
>二元运算: 与(AND), 异或(XOR)
>
> 
>
>CU 控制单元， 解释执行IR中的指令(用时钟脉冲流和操作码生成控制计算机总线， 存储器， 寄存器和功能单元的信号)

>计算机的存储器按照*字节*来确定地址， 各个字节的存储单元依次命名为0， 1， 2...
>
>32位微处理器使用32指令和32位字数据
>
>取指后PC必须+4， 因为 4 * 8 = 32位 -> 1字节
>
> 
>
><div style="color: #FF00FF">地址的概念:<br />
>存储器被划分为若干单元， 从0号单元开始编号， 这些编号就是地址<br />
>如上的例子也就是说， 使用四个一字节存储单元联合共存一条指令， 所以实际上四个地址共同存储一条指令</div>



## 扩展处理器: 常量处理

立即数(literal) 是一个在运算中可以直接使用的数， 和存储单元的值不同， 需要用哈希符号(#)前缀来声明

>LDR r1, #200 将常量200加载到寄存器中([r1] <- 200)



### 一些常用指令

>LDR r0, addr 将地址的内容加载到寄存器
>
>STR r0, addr 将r0的值保存到addr存储单元中
>
>*以上的两条指令不属于ARM处理器的指令集， 汇编器会自动把它们翻译成其他等效语言*
>
>ADD r0, r1, r2
>
>SUB r0, r1, r2 将r1 - r2保存到r0
>
>BPL target 若前一操作的结果大于等于0， 则跳转到地址target
>
>BEQ target 如果先前操作的结果是0， 跳转target
>
>B target 强制跳转到target



## 流控制

流控制是指计算机非顺序执行指令的能力



### 条件码寄存器(Condition Code Register, *CCR*)

ALU的信息将被写入CCR， 它保存了各种用于测试的条件(零负正等), 当ALU执行一个操作时， 它会更新CCR中的零位， 借位位， 负位， 溢出位(是特殊寄存器)

>当BEQ等分支指令执行时， 控制单元CU从CCR中取出所需的条件位并进行测试， 如果测试条件为false， 则PC + 4， 否则CPU跳转到指令分支字段所指定的地址处， 该地址被称为*分支目标地址*



计算机执行一个操作时， 它会把状态或者条件信息保存在CCR中， 处理器记录下结果是否是0(Z), 是否为负(N), 是否进位(C), 是否算术溢出(V)

>CCR中的内容由测试指令的上一条指令决定



## 寄存器

片内的一个指针寄存器保存了存储器中*寄存器的地址*

实际计算机用寄存器来实现*片上存储*， 寄存器和存储单元的唯一区别就在于访问的*便捷性*和*响应时间*



## 寻址方式

指定数据的方式称为寻址方式(找到要操作的数的位置)



### 立即数寻址

>P = Q + 5

5是立即数， 没有被保存在存储器或寄存器中

ARM使用#指定立即数



### 直接寻址

也称为*绝对寻址*， 把*操作数的地址*用作指令的一部分

CISC广泛应用直接寻址， 但是Load/Store型， 比如ARM， 没有实现直接寻址



### 间接寻址

指令给出的是包含操作数地址的寄存器地址

含有操作数地址的寄存器称作*指针寄存器*



#### 带偏移量间接寻址

操作数的地址由寄存器内容加上常量或偏移量指定

>LDR r2, [r3, #8]
>
>MOV ax, [12, bx]
>
>MOVE (16, A5), D2

>指定寄存器所需的地址位数一般远远少于存储器地址
