# DNS

DNS是因特网的目录服务



### 标识主机的方法

**主机名和IP地址**



主机名到ip地址转换的目录服务是域名系统(DNS)的主要任务



DNS是**一个由分层的DNS服务器实现的分布式数据库**， 也是**一个使得主机可以查询分布式数据库的应用层协议**



DNS协议运行在UDP之上



**因特网体系结构的复杂性大多数位于网络的边缘**， DNS的客户和服务器也是位于网络边缘的



### 流程

同一台用户主机上运行着dns的客户端

浏览器从url中抽出主机名， 并传给dns客户端

客户端向dns服务器发出一个请求

dns收到含有IP地址的报文

浏览器接收到IP地址后发起TCP连接



dns可能会造成额外的时延， 因此dns也具有缓存



### DNS还提供的一些服务

**支持主机别名和邮件服务器别名**

**负载分配**

>DNS也负责在冗余的服务器之间进行负载分配。
>
>一个ip地址集合和一个规范主机名对应



DNS在因特网上实现分布式数据库



## DNS服务器的类型

**根DNS服务器(.)**



**顶级域(TLD) dns服务器**

>mail.cctv.com
>
>三级域名.二级域名.顶级域名

**权威dns服务器**



当查询ip地址时， 首先和根服务器联系，  然后返回对应顶级域名(com, cn等) 的TLD服务器之一， 然后客户和这些服务器联系， 再返回权威服务器的IP， 最后权威服务器响应



**除此之外， 还有一类本地DNS服务器**

>本地DNS服务器不属于DNS服务器的层次结构， 但是对于层次结构至关重要
>
> 
>
>每个ISP都有一个本地DNS服务器， 也叫默认名字服务器
>
> 
>
>它起着代理的作用， 将请求转发到dns层次结构中



### 递归查询和迭代查询



**递归查询**

如果主机所询问的本地域名服务器不知道被查询的域名的ip地址，  那么本地域名服务器会作为客户端向根域名发出查询

**也就是说， 递归查询后， 客户端发生了改变， 不是主机而是本地域名服务器**

(主机向本地dns服务器)



**迭代查询**

本地dns服务器向根域名服务器查询后， 根域名服务器会返回一个列表， 然后本地域名服务器再向列表中的服务器发出请求

**也就是说， 迭代查询后， 客户端没有发生改变， 请求仍然是原来的客户端发出的**

(本地dns服务器向根服务器发出请求)



## DNS缓存

dns服务器可以缓存dns回答， 比如说映射， 也可以缓存服务器的ip地址， 比如说如果缓存了TLD服务器的地址， 就不用访问根服务器了



## DNS记录和报文

dns服务器存储了**资源记录(RR)**

RR提供了主机名到IP地址的映射， dns回答报文包含了一条或者是多条RR



RR格式如下

(Name, Value, Type, TTL)

>TTL是该条记录的生存时间， 决定了会从缓存中被删除的时间