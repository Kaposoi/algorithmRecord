# 网络核心



## 分组交换

在各种网络应用中， 端系统彼此交换**报文**

报文能够包含协议设计者需要的任何东西， 报文可以执行一种控制功能(**基于首部字节**)， 也可以包含数据， 比如说电邮， jpeg图像等

为了从源端系统发送一个报文， 源端系统将长报文划分为较小的数据块， 称为**分组(packet)**

在源和目的之间， 每个分组都通过通信链路和分组交换机传送

分组会以等于该链路**最大传输速率**的速度传输通过通信链路， 如果端系统或分组交换机经过一条链路发送一个**L比特**的分组， 链路传输速率为**R比特/s**， 则传输该分组的时间为
$$
\frac{L}{R}秒
$$


### 存储转发机制

多数分组交换机在链路的输入端使用**存储转发传输**

>交换机开始向输出链路传输该分组的第一个比特前， 必须接收到整个分组

每个分组交换机有多条链路与之相连， 对于每条相连的链路， 该分组交换机有一个**输出缓存(输出队列)**， 它存储路由器准备发往那条链路的分组。



如果到达的分组需要传输到某条链路， 但发现该链路正忙于传输其他分组， 该到达分组必须在该输出缓存中等待， 分组因此承受了输出缓存的排队时延， 长度取决于网络中的**拥塞程度**



因为缓存的大小是有限的， 一个到达的分组可能发现缓存队列已经被充满， 此时到达的分组或者在排队的分组之一会被丢弃， 就是**丢包**





### 转发表和路由选择协议

不同的计算机网络对于分组交换机转发链路的确定有不同的实现， 因特网主要是**转发表和路由选择协议**



因特网中的每个端系统都拥有**ip地址**， 分组的首部字节就包含了**目的地的ip地址**， 该地址具有一种等级结构， 当一个分组到达路由器时， 路由器检查该分组的目的地址的一部分， 并向一台相邻路由器转发该分组



每台路由器都具有一个**转发表**， 转发表用于将目的地址或之的一部分来映射为输出链路， 路由器检查ip地址， 并用目的地址搜索转发表， 发现适当的出链路后将分组导向出链路



因特网具有一些特殊的**路由选择协议**， 这些协议用于**自动地**来设置转发表， 例如它可以决定最短路径



